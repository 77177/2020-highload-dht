В рамках использования утилиты wrk2|profiler сервер имеет следующие показатели для put.
---------------------------------------------------------------------------------------
1) Команды 

rm wrkLogsPut.txt

./wrk2/wrk -t1 -c1 -d15s -R2000 -s ./wrk2/scripts/put.lua --u_latency http://localhost:8080/v0/entity?id=100 > wrkLogsPut.txt &

rm flamePutCpu.svg 

rm flamePutAlloc.svg 

./async-profiler-1.8.1-linux-x64/profiler.sh -d 5 -e cpu -f flamePutCpu.svg $(lsof -t -i :8080 -s TCP:LISTEN)

./async-profiler-1.8.1-linux-x64/profiler.sh -d 5 -e alloc -f flamePutAlloc.svg $(lsof -t -i :8080 -s TCP:LISTEN)

----------------------------------------------------------------------------------------

1) Логи

Running 15s test @ http://localhost:8080/v0/entity?id=100

  1 threads and 1 connections

  Thread calibration: mean lat.: 1.095ms, rate sampling interval: 10ms


    Thread Stats   Avg      Stdev     Max   +/- Stdev

    Latency     1.10ms  499.29us   2.63ms   62.28%

    Req/Sec     2.10k   172.87     2.67k    65.59%

  Latency Distribution (HdrHistogram - Recorded Latency)

 50.000%    1.09ms

 75.000%    1.47ms

 90.000%    1.80ms

 99.000%    2.11ms

 99.900%    2.23ms

 99.990%    2.35ms

 99.999%    2.63ms

100.000%    2.63ms

  Detailed Percentile spectrum:

       Value   Percentile   TotalCount 1/(1-Percentile)

       0.071     0.000000            1         1.00
       0.408     0.100000         1003         1.11
       0.631     0.200000         2007         1.25
       0.823     0.300000         3002         1.43
       0.972     0.400000         4002         1.67
       1.093     0.500000         5001         2.00
       1.154     0.550000         5499         2.22
       1.217     0.600000         5998         2.50
       1.280     0.650000         6505         2.86
       1.360     0.700000         6995         3.33
       1.469     0.750000         7494         4.00
       1.519     0.775000         7745         4.44
       1.575     0.800000         7995         5.00
       1.637     0.825000         8246         5.71
       1.693     0.850000         8495         6.67
       1.747     0.875000         8744         8.00
       1.776     0.887500         8871         8.89
       1.804     0.900000         8995        10.00
       1.835     0.912500         9122        11.43
       1.867     0.925000         9246        13.33
       1.902     0.937500         9373        16.00
       1.919     0.943750         9437        17.78
       1.934     0.950000         9494        20.00
       1.953     0.956250         9555        22.86
       1.980     0.962500         9618        26.67
       2.009     0.968750         9683        32.00
       2.021     0.971875         9711        35.56
       2.033     0.975000         9744        40.00
       2.045     0.978125         9774        45.71
       2.063     0.981250         9810        53.33
       2.077     0.984375         9839        64.00
       2.089     0.985938         9857        71.11
       2.097     0.987500         9870        80.00
       2.105     0.989062         9883        91.43
       2.117     0.990625         9901       106.67
       2.129     0.992188         9915       128.00
       2.135     0.992969         9923       142.22
       2.145     0.993750         9933       160.00
       2.151     0.994531         9939       182.86
       2.161     0.995313         9948       213.33
       2.167     0.996094         9956       256.00
       2.169     0.996484         9957       284.44
       2.175     0.996875         9962       320.00
       2.179     0.997266         9965       365.71
       2.185     0.997656         9969       426.67
       2.195     0.998047         9973       512.00
       2.205     0.998242         9975       568.89
       2.209     0.998437         9977       640.00
       2.225     0.998633         9979       731.43
       2.231     0.998828         9982       853.33
       2.235     0.999023         9983      1024.00
       2.237     0.999121         9984      1137.78
       2.243     0.999219         9985      1280.00
       2.247     0.999316         9986      1462.86
       2.259     0.999414         9987      1706.67
       2.263     0.999512         9988      2048.00
       2.263     0.999561         9988      2275.56
       2.281     0.999609         9989      2560.00
       2.281     0.999658         9989      2925.71
       2.293     0.999707         9990      3413.33
       2.293     0.999756         9990      4096.00
       2.293     0.999780         9990      4551.11
       2.351     0.999805         9991      5120.00
       2.351     0.999829         9991      5851.43
       2.351     0.999854         9991      6826.67
       2.351     0.999878         9991      8192.00
       2.351     0.999890         9991      9102.22
       2.635     0.999902         9992     10240.00
       2.635     1.000000         9992          inf
[Mean    =        1.101, StdDeviation   =        0.499]

[Max     =        2.634, Total count    =         9992]

[Buckets =           27, SubBuckets     =         2048]

----------------------------------------------------------

 Latency Distribution (HdrHistogram - Uncorrected Latency (measured without taking delayed starts into account))

 50.000%  206.00us

 75.000%  242.00us

 90.000%  261.00us

 99.000%  306.00us

 99.900%  381.00us

 99.990%  473.00us

 99.999%    1.39ms

100.000%    1.39ms

  Detailed Percentile spectrum:
      
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.031     0.000000            1         1.00
       0.110     0.100000         1023         1.11
       0.136     0.200000         2039         1.25
       0.154     0.300000         3038         1.43
       0.181     0.400000         4019         1.67
       0.206     0.500000         5000         2.00
       0.217     0.550000         5512         2.22
       0.226     0.600000         6023         2.50
       0.231     0.650000         6539         2.86
       0.236     0.700000         7098         3.33
       0.242     0.750000         7505         4.00
       0.245     0.775000         7835         4.44
       0.247     0.800000         8046         5.00
       0.249     0.825000         8252         5.71
       0.252     0.850000         8517         6.67
       0.256     0.875000         8761         8.00
       0.259     0.887500         8913         8.89
       0.261     0.900000         9022        10.00
       0.264     0.912500         9135        11.43
       0.267     0.925000         9251        13.33
       0.270     0.937500         9379        16.00
       0.272     0.943750         9461        17.78
       0.273     0.950000         9496        20.00
       0.275     0.956250         9562        22.86
       0.277     0.962500         9624        26.67
       0.280     0.968750         9684        32.00
       0.282     0.971875         9714        35.56
       0.285     0.975000         9746        40.00
       0.289     0.978125         9784        45.71
       0.292     0.981250         9813        53.33
       0.295     0.984375         9836        64.00
       0.299     0.985938         9855        71.11
       0.301     0.987500         9868        80.00
       0.305     0.989062         9886        91.43
       0.308     0.990625         9900       106.67
       0.312     0.992188         9916       128.00
       0.313     0.992969         9922       142.22
       0.317     0.993750         9932       160.00
       0.320     0.994531         9938       182.86
       0.326     0.995313         9947       213.33
       0.329     0.996094         9954       256.00
       0.332     0.996484         9959       284.44
       0.335     0.996875         9961       320.00
       0.343     0.997266         9967       365.71
       0.346     0.997656         9970       426.67
       0.351     0.998047         9973       512.00
       0.355     0.998242         9975       568.89
       0.361     0.998437         9977       640.00
       0.369     0.998633         9979       731.43
       0.378     0.998828         9981       853.33
       0.381     0.999023         9983      1024.00
       0.385     0.999121         9984      1137.78
       0.387     0.999219         9985      1280.00
       0.404     0.999316         9986      1462.86
       0.406     0.999414         9987      1706.67
       0.435     0.999512         9988      2048.00
       0.435     0.999561         9988      2275.56
       0.455     0.999609         9989      2560.00
       0.455     0.999658         9989      2925.71
       0.463     0.999707         9990      3413.33
       0.463     0.999756         9990      4096.00
       0.463     0.999780         9990      4551.11
       0.473     0.999805         9991      5120.00
       0.473     0.999829         9991      5851.43
       0.473     0.999854         9991      6826.67
       0.473     0.999878         9991      8192.00
       0.473     0.999890         9991      9102.22
       1.394     0.999902         9992     10240.00
       1.394     1.000000         9992          inf
[Mean    =        0.194, StdDeviation   =        0.060]

[Max     =        1.394, Total count    =         9992]

[Buckets =           27, SubBuckets     =         2048]

----------------------------------------------------------

30000 requests in 15.00s, 1.92MB read

Requests/sec:   1999.93

Transfer/sec:    130.85KB


----------------------------------------------------------------
CPU put
----------------------------------------------------
![alt text](flamePutCpu.svg "put cpu")
------------------------------------------------------
ALLOC put
----------------------------------------------------
![alt text](flamePutAlloc.svg "put alloc")


----------------------------------------------------------------------------------------
В рамках использования утилиты wrk2|profiler сервер имеет следующие показатели для get.
---------------------------------------------------------------------------------------
1) Команды 

rm wrkLogsGet.txt

./wrk2/wrk -t1 -c1 -d15s -R2000 --u_latency http://localhost:8080/v0/entity?id=100 > wrkLogsGet.txt &

rm flameGetCpu.svg 

rm flameGetAlloc.svg  

./async-profiler-1.8.1-linux-x64/profiler.sh -d 5 -e cpu -f flameGetCpu.svg $(lsof -t -i :8080 -s TCP:LISTEN)

./async-profiler-1.8.1-linux-x64/profiler.sh -d 5 -e alloc -f flameGetAlloc.svg $(lsof -t -i :8080 -s TCP:LISTEN)


----------------------------------------------------------------------------------------------

1) Логи

Running 15s test @ http://localhost:8080/v0/entity?id=100
 
  1 threads and 1 connections
 
  Thread calibration: mean lat.: 1.131ms, rate sampling interval: 10ms
 
    Thread Stats   Avg      Stdev     Max   +/- Stdev
 
    Latency     1.11ms  499.56us   2.25ms   61.61%
 
    Req/Sec     2.11k   180.78     2.56k    59.27%
 
  Latency Distribution (HdrHistogram - Recorded Latency)
 
 50.000%    1.11ms
 
 75.000%    1.50ms
 
 90.000%    1.81ms
 
 99.000%    2.11ms
 
 99.900%    2.17ms
 
 99.990%    2.22ms
 
 99.999%    2.26ms

100.000%    2.26ms

  Detailed Percentile spectrum:
 
       Value   Percentile   TotalCount 1/(1-Percentile)

       0.092     0.000000            1         1.00
       0.421     0.100000          999         1.11
       0.631     0.200000         2000         1.25
       0.841     0.300000         3002         1.43
       0.986     0.400000         3997         1.67
       1.106     0.500000         5004         2.00
       1.171     0.550000         5495         2.22
       1.233     0.600000         5995         2.50
       1.296     0.650000         6495         2.86
       1.382     0.700000         6994         3.33
       1.495     0.750000         7495         4.00
       1.545     0.775000         7746         4.44
       1.598     0.800000         7995         5.00
       1.659     0.825000         8245         5.71
       1.707     0.850000         8496         6.67
       1.757     0.875000         8744         8.00
       1.784     0.887500         8874         8.89
       1.808     0.900000         8992        10.00
       1.838     0.912500         9117        11.43
       1.868     0.925000         9241        13.33
       1.904     0.937500         9365        16.00
       1.921     0.943750         9429        17.78
       1.940     0.950000         9490        20.00
       1.961     0.956250         9553        22.86
       1.982     0.962500         9616        26.67
       2.005     0.968750         9677        32.00
       2.018     0.971875         9710        35.56
       2.029     0.975000         9742        40.00
       2.046     0.978125         9773        45.71
       2.061     0.981250         9802        53.33
       2.079     0.984375         9838        64.00
       2.087     0.985938         9850        71.11
       2.099     0.987500         9868        80.00
       2.107     0.989062         9881        91.43
       2.115     0.990625         9897       106.67
       2.121     0.992188         9911       128.00
       2.127     0.992969         9922       142.22
       2.131     0.993750         9928       160.00
       2.135     0.994531         9935       182.86
       2.141     0.995313         9943       213.33
       2.147     0.996094         9952       256.00
       2.149     0.996484         9954       284.44
       2.151     0.996875         9958       320.00
       2.157     0.997266         9967       365.71
       2.157     0.997656         9967       426.67
       2.165     0.998047         9970       512.00
       2.167     0.998242         9972       568.89
       2.169     0.998437         9975       640.00
       2.173     0.998633         9978       731.43
       2.173     0.998828         9978       853.33
       2.177     0.999023         9982      1024.00
       2.177     0.999121         9982      1137.78
       2.177     0.999219         9982      1280.00
       2.185     0.999316         9983      1462.86
       2.187     0.999414         9984      1706.67
       2.197     0.999512         9985      2048.00
       2.197     0.999561         9985      2275.56
       2.207     0.999609         9986      2560.00
       2.207     0.999658         9986      2925.71
       2.211     0.999707         9987      3413.33
       2.211     0.999756         9987      4096.00
       2.211     0.999780         9987      4551.11
       2.225     0.999805         9988      5120.00
       2.225     0.999829         9988      5851.43
       2.225     0.999854         9988      6826.67
       2.225     0.999878         9988      8192.00
       2.225     0.999890         9988      9102.22
       2.255     0.999902         9989     10240.00
       2.255     1.000000         9989          inf

[Mean    =        1.114, StdDeviation   =        0.500]

[Max     =        2.254, Total count    =         9989]

[Buckets =           27, SubBuckets     =         2048]

----------------------------------------------------------

 Latency Distribution (HdrHistogram - Uncorrected Latency (measured without taking delayed starts into account))
 
 50.000%  223.00us
 
 75.000%  245.00us
 
 90.000%  256.00us
 
 99.000%  275.00us
 
 99.900%  303.00us
 
 99.990%  332.00us
 
 99.999%  346.00us

100.000%  346.00us

  Detailed Percentile spectrum:

       Value   Percentile   TotalCount 1/(1-Percentile)

       0.052     0.000000            1         1.00
       0.125     0.100000          999         1.11
       0.145     0.200000         2020         1.25
       0.159     0.300000         3009         1.43
       0.194     0.400000         4005         1.67
       0.223     0.500000         5051         2.00
       0.231     0.550000         5505         2.22
       0.236     0.600000         6198         2.50
       0.238     0.650000         6643         2.86
       0.241     0.700000         7077         3.33
       0.245     0.750000         7620         4.00
       0.246     0.775000         7817         4.44
       0.247     0.800000         8046         5.00
       0.249     0.825000         8308         5.71
       0.251     0.850000         8504         6.67
       0.254     0.875000         8837         8.00
       0.255     0.887500         8950         8.89
       0.256     0.900000         9087        10.00
       0.257     0.912500         9215        11.43
       0.258     0.925000         9322        13.33
       0.259     0.937500         9400        16.00
       0.260     0.943750         9472        17.78
       0.261     0.950000         9527        20.00
       0.262     0.956250         9560        22.86
       0.264     0.962500         9626        26.67
       0.267     0.968750         9707        32.00
       0.268     0.971875         9735        35.56
       0.269     0.975000         9767        40.00
       0.270     0.978125         9797        45.71
       0.271     0.981250         9826        53.33
       0.272     0.984375         9855        64.00
       0.272     0.985938         9855        71.11
       0.273     0.987500         9866        80.00
       0.275     0.989062         9891        91.43
       0.276     0.990625         9898       106.67
       0.279     0.992188         9911       128.00
       0.281     0.992969         9922       142.22
       0.282     0.993750         9927       160.00
       0.284     0.994531         9937       182.86
       0.286     0.995313         9946       213.33
       0.288     0.996094         9951       256.00
       0.289     0.996484         9955       284.44
       0.290     0.996875         9958       320.00
       0.293     0.997266         9963       365.71
       0.294     0.997656         9969       426.67
       0.295     0.998047         9971       512.00
       0.297     0.998242         9973       568.89
       0.298     0.998437         9974       640.00
       0.299     0.998633         9977       731.43
       0.300     0.998828         9978       853.33
       0.306     0.999023         9981      1024.00
       0.306     0.999121         9981      1137.78
       0.307     0.999219         9982      1280.00
       0.308     0.999316         9983      1462.86
       0.315     0.999414         9985      1706.67
       0.315     0.999512         9985      2048.00
       0.315     0.999561         9985      2275.56
       0.321     0.999609         9986      2560.00
       0.321     0.999658         9986      2925.71
       0.332     0.999707         9988      3413.33
       0.332     0.999756         9988      4096.00
       0.332     0.999780         9988      4551.11
       0.332     0.999805         9988      5120.00
       0.332     0.999829         9988      5851.43
       0.332     0.999854         9988      6826.67
       0.332     0.999878         9988      8192.00
       0.332     0.999890         9988      9102.22
       0.346     0.999902         9989     10240.00
       0.346     1.000000         9989          inf
[Mean    =        0.201, StdDeviation   =        0.052]

[Max     =        0.346, Total count    =         9989]

[Buckets =           27, SubBuckets     =         2048]

----------------------------------------------------------

29999 requests in 15.00s, 1.86MB read

Requests/sec:   1999.95

Transfer/sec:    126.95KB


CPU get
-----------------------------------------------------------------------------------------------
![alt text](flameGetCpu.svg "get cpu")

ALLOC get
------------------------------------------------------------------------------------------------
![alt text](flameGetAlloc.svg "get alloc")
------------------------------------------------------------------------------------------------

Выводы:

Из данных профилирования видно, что разброс во времени задержки 
и запросов в секунду больше у PUT чем у GET. 
Это скорее всего связано с вызовом дополнительной функциональности 
для сохранения тела запроса в RocksDB, которую можно заметить на flamegraph 
для PUT cpu. Так же из flamegraph PUT alloc можно заметить, 
что он гораздо более дробленный по сравнению с GET alloc. 
Это означает, что аллокации памяти происходят более решулярно и 
так же скорее всего замедляет в некоторых запросах скорость работы т.к.
процессор не может эффективно предсказать какие команды надо загружать 
в кэш-память процессора.


PUT
1) Задрежка средняя - 1.1 мс. (Макс. - 2.63 мс.)
2) Запросов в секунду в среднем - 2100 (Макс. - 2670)
3) 90% запросов укладываются в 1.80ms.

GET
1) Задрежка средняя - 1.11 мс. (Макс. - 2.25 мс.)
2) Запросов в секунду в среднем - 2110 (Макс. - 2560)
3) 90% запросов укладываются в 1.81ms.